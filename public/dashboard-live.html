<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routz - Dashboard Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        .animate-pulse-live { animation: pulse 2s infinite; }
        .animate-slide-in { animation: slideInRight 0.3s ease-out; }
        .live-dot { animation: pulse 1.5s infinite; }
    </style>
</head>
<body class="bg-gray-900 min-h-screen text-white">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { AreaChart, Area, LineChart, Line, BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;

        // Simulated WebSocket connection
        class MockWebSocket {
            constructor(onMessage) {
                this.onMessage = onMessage;
                this.connected = false;
                this.connect();
            }

            connect() {
                setTimeout(() => {
                    this.connected = true;
                    this.startSimulation();
                }, 500);
            }

            startSimulation() {
                // Simulate live updates
                setInterval(() => {
                    const events = [
                        { type: 'tracking_update', data: this.generateTrackingUpdate() },
                        { type: 'new_order', data: this.generateNewOrder() },
                        { type: 'delivery_success', data: this.generateDeliverySuccess() },
                        { type: 'stats_update', data: this.generateStatsUpdate() }
                    ];
                    const event = events[Math.floor(Math.random() * events.length)];
                    this.onMessage(event);
                }, 3000);
            }

            generateTrackingUpdate() {
                const statuses = ['in_transit', 'out_for_delivery', 'delivered', 'exception'];
                const carriers = ['Colissimo', 'Chronopost', 'DHL', 'UPS'];
                return {
                    trackingNumber: `6L${Math.random().toString().slice(2, 11)}FR`,
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    carrier: carriers[Math.floor(Math.random() * carriers.length)],
                    location: 'Paris, France',
                    timestamp: new Date().toISOString()
                };
            }

            generateNewOrder() {
                const customers = ['Marie D.', 'Jean M.', 'Sophie B.', 'Pierre L.', 'Emma R.'];
                return {
                    orderNumber: `ORD-${Math.random().toString().slice(2, 8)}`,
                    customer: customers[Math.floor(Math.random() * customers.length)],
                    total: (Math.random() * 200 + 20).toFixed(2),
                    items: Math.floor(Math.random() * 5) + 1,
                    timestamp: new Date().toISOString()
                };
            }

            generateDeliverySuccess() {
                return {
                    trackingNumber: `6L${Math.random().toString().slice(2, 11)}FR`,
                    customer: 'Client',
                    deliveredAt: new Date().toISOString()
                };
            }

            generateStatsUpdate() {
                return {
                    shipmentsToday: Math.floor(Math.random() * 50) + 100,
                    pendingOrders: Math.floor(Math.random() * 30) + 10,
                    activeDeliveries: Math.floor(Math.random() * 100) + 50,
                    deliveryRate: (Math.random() * 5 + 92).toFixed(1)
                };
            }
        }

        const LiveDashboard = () => {
            const [connected, setConnected] = useState(false);
            const [stats, setStats] = useState({
                shipmentsToday: 127,
                pendingOrders: 23,
                activeDeliveries: 89,
                deliveryRate: 94.5,
                exceptions: 3
            });
            const [recentEvents, setRecentEvents] = useState([]);
            const [liveTrackings, setLiveTrackings] = useState([]);
            const [chartData, setChartData] = useState([
                { time: '00:00', shipments: 0, orders: 0 },
                { time: '04:00', shipments: 5, orders: 8 },
                { time: '08:00', shipments: 25, orders: 32 },
                { time: '12:00', shipments: 65, orders: 78 },
                { time: '16:00', shipments: 98, orders: 105 },
                { time: '20:00', shipments: 120, orders: 125 },
            ]);

            const wsRef = useRef(null);

            useEffect(() => {
                wsRef.current = new MockWebSocket((event) => {
                    handleWebSocketMessage(event);
                });
                setConnected(true);

                return () => {
                    // Cleanup
                };
            }, []);

            const handleWebSocketMessage = (event) => {
                const { type, data } = event;

                // Add to recent events
                setRecentEvents(prev => [{
                    id: Date.now(),
                    type,
                    data,
                    timestamp: new Date()
                }, ...prev].slice(0, 10));

                switch (type) {
                    case 'tracking_update':
                        setLiveTrackings(prev => [data, ...prev].slice(0, 5));
                        break;
                    case 'stats_update':
                        setStats(prev => ({ ...prev, ...data }));
                        break;
                    case 'new_order':
                        setStats(prev => ({ ...prev, pendingOrders: prev.pendingOrders + 1 }));
                        break;
                    case 'delivery_success':
                        setStats(prev => ({ 
                            ...prev, 
                            activeDeliveries: Math.max(0, prev.activeDeliveries - 1),
                            shipmentsToday: prev.shipmentsToday + 1
                        }));
                        break;
                }
            };

            const StatCard = ({ title, value, change, icon, color }) => (
                <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                    <div className="flex items-center justify-between mb-4">
                        <span className="text-gray-400 text-sm">{title}</span>
                        <span className="text-2xl">{icon}</span>
                    </div>
                    <p className="text-3xl font-bold" style={{ color }}>{value}</p>
                    {change && (
                        <p className={`text-sm mt-2 ${change > 0 ? 'text-green-400' : 'text-red-400'}`}>
                            {change > 0 ? 'â†‘' : 'â†“'} {Math.abs(change)}% vs hier
                        </p>
                    )}
                </div>
            );

            const EventItem = ({ event }) => {
                const configs = {
                    tracking_update: { icon: 'ðŸ“¦', color: 'text-blue-400', label: 'Mise Ã  jour tracking' },
                    new_order: { icon: 'ðŸ›’', color: 'text-green-400', label: 'Nouvelle commande' },
                    delivery_success: { icon: 'âœ…', color: 'text-emerald-400', label: 'Livraison rÃ©ussie' },
                    stats_update: { icon: 'ðŸ“Š', color: 'text-purple-400', label: 'Stats mises Ã  jour' }
                };
                const config = configs[event.type] || { icon: 'ðŸ“Œ', color: 'text-gray-400', label: event.type };

                return (
                    <div className="flex items-start gap-3 p-3 bg-gray-800/50 rounded-xl animate-slide-in">
                        <span className="text-xl">{config.icon}</span>
                        <div className="flex-1 min-w-0">
                            <p className={`text-sm font-medium ${config.color}`}>{config.label}</p>
                            <p className="text-xs text-gray-500 truncate">
                                {event.type === 'tracking_update' && `${event.data.trackingNumber} - ${event.data.status}`}
                                {event.type === 'new_order' && `${event.data.orderNumber} - ${event.data.customer} - ${event.data.total}â‚¬`}
                                {event.type === 'delivery_success' && `${event.data.trackingNumber} livrÃ©`}
                            </p>
                        </div>
                        <span className="text-xs text-gray-600">
                            {event.timestamp.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                        </span>
                    </div>
                );
            };

            const TrackingCard = ({ tracking }) => {
                const statusColors = {
                    in_transit: 'bg-blue-500',
                    out_for_delivery: 'bg-purple-500',
                    delivered: 'bg-green-500',
                    exception: 'bg-red-500'
                };

                return (
                    <div className="bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                        <div className="flex items-center justify-between mb-2">
                            <span className="font-mono text-sm text-gray-300">{tracking.trackingNumber}</span>
                            <span className={`w-2 h-2 rounded-full ${statusColors[tracking.status]} live-dot`} />
                        </div>
                        <div className="flex items-center justify-between text-xs">
                            <span className="text-gray-500">{tracking.carrier}</span>
                            <span className="text-gray-400">{tracking.location}</span>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-900">
                    {/* Header */}
                    <header className="bg-gray-800 border-b border-gray-700 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-gradient-to-br from-[#00FF88] to-[#00D4AA] rounded-xl flex items-center justify-center">
                                    <span className="text-black font-bold">R</span>
                                </div>
                                <div>
                                    <h1 className="font-semibold text-white">Dashboard Live</h1>
                                    <p className="text-xs text-gray-400">Temps rÃ©el</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-2">
                                    <span className={`w-2 h-2 rounded-full ${connected ? 'bg-green-400 live-dot' : 'bg-red-400'}`} />
                                    <span className="text-sm text-gray-400">{connected ? 'ConnectÃ©' : 'DÃ©connectÃ©'}</span>
                                </div>
                                <span className="text-sm text-gray-500">
                                    {new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' })}
                                </span>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {/* Stats */}
                        <div className="grid grid-cols-5 gap-4 mb-6">
                            <StatCard title="ExpÃ©ditions aujourd'hui" value={stats.shipmentsToday} change={12} icon="ðŸ“¦" color="#00FF88" />
                            <StatCard title="Commandes en attente" value={stats.pendingOrders} icon="ðŸ›’" color="#FBBF24" />
                            <StatCard title="Livraisons actives" value={stats.activeDeliveries} icon="ðŸšš" color="#60A5FA" />
                            <StatCard title="Taux de livraison" value={`${stats.deliveryRate}%`} change={2.1} icon="ðŸ“ˆ" color="#34D399" />
                            <StatCard title="Exceptions" value={stats.exceptions} icon="âš ï¸" color="#EF4444" />
                        </div>

                        <div className="grid grid-cols-3 gap-6 mb-6">
                            {/* Activity Chart */}
                            <div className="col-span-2 bg-gray-800 rounded-2xl p-6 border border-gray-700">
                                <h3 className="font-semibold text-white mb-4">ðŸ“Š ActivitÃ© du jour</h3>
                                <ResponsiveContainer width="100%" height={250}>
                                    <AreaChart data={chartData}>
                                        <defs>
                                            <linearGradient id="colorShipments" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#00FF88" stopOpacity={0.3}/>
                                                <stop offset="95%" stopColor="#00FF88" stopOpacity={0}/>
                                            </linearGradient>
                                            <linearGradient id="colorOrders" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#60A5FA" stopOpacity={0.3}/>
                                                <stop offset="95%" stopColor="#60A5FA" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <XAxis dataKey="time" stroke="#6B7280" fontSize={12} />
                                        <YAxis stroke="#6B7280" fontSize={12} />
                                        <Tooltip 
                                            contentStyle={{ backgroundColor: '#1F2937', border: 'none', borderRadius: '8px' }}
                                            labelStyle={{ color: '#9CA3AF' }}
                                        />
                                        <Area type="monotone" dataKey="shipments" stroke="#00FF88" fill="url(#colorShipments)" strokeWidth={2} name="ExpÃ©ditions" />
                                        <Area type="monotone" dataKey="orders" stroke="#60A5FA" fill="url(#colorOrders)" strokeWidth={2} name="Commandes" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>

                            {/* Live Trackings */}
                            <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="font-semibold text-white">ðŸ”´ Suivi en direct</h3>
                                    <span className="w-2 h-2 bg-red-500 rounded-full live-dot" />
                                </div>
                                <div className="space-y-3">
                                    {liveTrackings.length === 0 ? (
                                        <p className="text-gray-500 text-sm text-center py-8">En attente de mises Ã  jour...</p>
                                    ) : (
                                        liveTrackings.map((tracking, i) => (
                                            <TrackingCard key={i} tracking={tracking} />
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Live Events Feed */}
                        <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="font-semibold text-white">âš¡ Ã‰vÃ©nements en direct</h3>
                                <div className="flex items-center gap-2">
                                    <span className="w-2 h-2 bg-green-400 rounded-full live-dot" />
                                    <span className="text-xs text-gray-500">Mise Ã  jour automatique</span>
                                </div>
                            </div>
                            <div className="space-y-2 max-h-96 overflow-y-auto">
                                {recentEvents.length === 0 ? (
                                    <p className="text-gray-500 text-sm text-center py-8">En attente d'Ã©vÃ©nements...</p>
                                ) : (
                                    recentEvents.map(event => (
                                        <EventItem key={event.id} event={event} />
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<LiveDashboard />);
    </script>
</body>
</html>
