<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routz - API Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .code-font { font-family: 'JetBrains Mono', monospace; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .json-key { color: #9B5DE5; }
        .json-string { color: #00D4AA; }
        .json-number { color: #F15BB5; }
        .json-boolean { color: #00B4D8; }
        .json-null { color: #6B7280; }
        .tab-active { border-bottom: 2px solid #00FF88; color: #00FF88; }
    </style>
</head>
<body class="bg-gray-900 min-h-screen text-white">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const Icons = {
            play: <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>,
            copy: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>,
            check: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            chevronDown: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
        };

        const methodColors = {
            GET: 'bg-green-500/20 text-green-400 border-green-500/30',
            POST: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
            PUT: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
            PATCH: 'bg-orange-500/20 text-orange-400 border-orange-500/30',
            DELETE: 'bg-red-500/20 text-red-400 border-red-500/30',
        };

        const endpoints = [
            { 
                category: 'Shipments',
                items: [
                    { method: 'GET', path: '/api/v1/shipments', name: 'List Shipments', desc: 'Get all shipments with pagination' },
                    { method: 'GET', path: '/api/v1/shipments/:id', name: 'Get Shipment', desc: 'Get shipment by ID' },
                    { method: 'POST', path: '/api/v1/shipments', name: 'Create Shipment', desc: 'Create a new shipment' },
                    { method: 'POST', path: '/api/v1/shipments/:id/cancel', name: 'Cancel Shipment', desc: 'Cancel a shipment' },
                    { method: 'GET', path: '/api/v1/shipments/:id/tracking', name: 'Get Tracking', desc: 'Get tracking events' },
                    { method: 'GET', path: '/api/v1/shipments/:id/label', name: 'Get Label', desc: 'Download shipping label' },
                ]
            },
            {
                category: 'Orders',
                items: [
                    { method: 'GET', path: '/api/v1/orders', name: 'List Orders', desc: 'Get all orders' },
                    { method: 'GET', path: '/api/v1/orders/:id', name: 'Get Order', desc: 'Get order by ID' },
                    { method: 'POST', path: '/api/v1/orders/sync', name: 'Sync Orders', desc: 'Sync orders from channel' },
                    { method: 'PATCH', path: '/api/v1/orders/:id', name: 'Update Order', desc: 'Update order status' },
                ]
            },
            {
                category: 'Rates',
                items: [
                    { method: 'POST', path: '/api/v1/rates', name: 'Get Rates', desc: 'Get shipping rates' },
                    { method: 'GET', path: '/api/v1/carriers', name: 'List Carriers', desc: 'Get available carriers' },
                ]
            },
            {
                category: 'Webhooks',
                items: [
                    { method: 'GET', path: '/api/v1/webhooks', name: 'List Webhooks', desc: 'Get webhook endpoints' },
                    { method: 'POST', path: '/api/v1/webhooks', name: 'Create Webhook', desc: 'Register new endpoint' },
                    { method: 'DELETE', path: '/api/v1/webhooks/:id', name: 'Delete Webhook', desc: 'Remove endpoint' },
                    { method: 'POST', path: '/api/v1/webhooks/:id/test', name: 'Test Webhook', desc: 'Send test ping' },
                ]
            }
        ];

        const exampleBodies = {
            'Create Shipment': JSON.stringify({
                carrier: "colissimo",
                service: "standard",
                recipient: {
                    name: "Jean Dupont",
                    line1: "123 Rue de Paris",
                    city: "Paris",
                    postalCode: "75001",
                    country: "FR",
                    phone: "+33612345678",
                    email: "jean@example.com"
                },
                parcels: [{
                    weight: 1.5,
                    length: 30,
                    width: 20,
                    height: 10
                }],
                reference: "ORDER-12345"
            }, null, 2),
            'Get Rates': JSON.stringify({
                sender: {
                    postalCode: "75001",
                    country: "FR"
                },
                recipient: {
                    postalCode: "69001",
                    country: "FR"
                },
                parcels: [{
                    weight: 2.0
                }]
            }, null, 2),
            'Create Webhook': JSON.stringify({
                url: "https://myshop.com/webhooks/routz",
                events: ["shipment.delivered", "shipment.exception"],
                name: "My Shop Webhook"
            }, null, 2),
            'Sync Orders': JSON.stringify({
                channel: "shopify",
                since: "2024-01-01T00:00:00Z"
            }, null, 2)
        };

        const sampleResponses = {
            'List Shipments': { data: [{ id: "shp_abc123", trackingNumber: "6L123456789FR", status: "in_transit", carrier: "colissimo" }], pagination: { total: 127, page: 1, perPage: 20 } },
            'Get Shipment': { id: "shp_abc123", trackingNumber: "6L123456789FR", status: "in_transit", carrier: "colissimo", recipient: { name: "Jean Dupont", city: "Paris" }, createdAt: "2024-11-28T10:00:00Z" },
            'Create Shipment': { id: "shp_new123", trackingNumber: "6L987654321FR", status: "pending", labelUrl: "https://labels.routz.com/6L987654321FR.pdf" },
            'Get Rates': { rates: [{ carrier: "colissimo", service: "standard", price: 6.50, estimatedDays: 3 }, { carrier: "chronopost", service: "express", price: 12.90, estimatedDays: 1 }] },
        };

        const formatJSON = (obj) => {
            const json = typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2);
            return json
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                .replace(/: "([^"]+)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/: (\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/: null/g, ': <span class="json-null">null</span>');
        };

        const APIPlayground = () => {
            const [selectedEndpoint, setSelectedEndpoint] = useState(null);
            const [activeTab, setActiveTab] = useState('params');
            const [responseTab, setResponseTab] = useState('body');
            const [requestBody, setRequestBody] = useState('');
            const [response, setResponse] = useState(null);
            const [loading, setLoading] = useState(false);
            const [copied, setCopied] = useState(false);
            const [expandedCategory, setExpandedCategory] = useState('Shipments');
            const [apiKey, setApiKey] = useState('rk_live_abc123xyz789');

            useEffect(() => {
                if (selectedEndpoint) {
                    setRequestBody(exampleBodies[selectedEndpoint.name] || '{}');
                    setResponse(null);
                }
            }, [selectedEndpoint]);

            const executeRequest = async () => {
                setLoading(true);
                setResponse(null);
                
                // Simulate API call
                await new Promise(r => setTimeout(r, 800 + Math.random() * 500));
                
                const sampleResponse = sampleResponses[selectedEndpoint?.name] || { success: true, message: "Operation completed" };
                
                setResponse({
                    status: 200,
                    statusText: 'OK',
                    time: Math.floor(Math.random() * 200) + 100,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Request-Id': `req_${Date.now().toString(36)}`,
                        'X-RateLimit-Remaining': '99'
                    },
                    body: sampleResponse
                });
                setLoading(false);
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(typeof text === 'object' ? JSON.stringify(text, null, 2) : text);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const generateCurl = () => {
                if (!selectedEndpoint) return '';
                const method = selectedEndpoint.method;
                const url = `https://api.routz.com${selectedEndpoint.path}`;
                let cmd = `curl -X ${method} "${url}"`;
                cmd += `\n  -H "Authorization: Bearer ${apiKey}"`;
                cmd += `\n  -H "Content-Type: application/json"`;
                if (['POST', 'PUT', 'PATCH'].includes(method) && requestBody) {
                    cmd += `\n  -d '${requestBody.replace(/\n/g, '').replace(/\s+/g, ' ')}'`;
                }
                return cmd;
            };

            return (
                <div className="min-h-screen bg-gray-900 flex">
                    {/* Sidebar - Endpoints */}
                    <div className="w-80 bg-gray-800 border-r border-gray-700 flex flex-col">
                        <div className="p-4 border-b border-gray-700">
                            <div className="flex items-center gap-2 mb-4">
                                <div className="w-8 h-8 bg-gradient-to-br from-[#00FF88] to-[#00D4AA] rounded-lg flex items-center justify-center">
                                    <span className="text-black font-bold text-sm">R</span>
                                </div>
                                <div>
                                    <h1 className="font-semibold">API Playground</h1>
                                    <p className="text-xs text-gray-400">v1.0</p>
                                </div>
                            </div>
                            <input type="text" placeholder="Search endpoints..."
                                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm placeholder-gray-500" />
                        </div>

                        <div className="flex-1 overflow-y-auto p-2">
                            {endpoints.map((cat, ci) => (
                                <div key={ci} className="mb-2">
                                    <button onClick={() => setExpandedCategory(expandedCategory === cat.category ? null : cat.category)}
                                        className="w-full flex items-center justify-between px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 rounded-lg">
                                        <span>{cat.category}</span>
                                        <span className={`transition-transform ${expandedCategory === cat.category ? 'rotate-180' : ''}`}>{Icons.chevronDown}</span>
                                    </button>
                                    {expandedCategory === cat.category && (
                                        <div className="ml-2 space-y-1 animate-slideIn">
                                            {cat.items.map((ep, ei) => (
                                                <button key={ei} onClick={() => setSelectedEndpoint(ep)}
                                                    className={`w-full flex items-center gap-2 px-3 py-2 text-sm rounded-lg ${selectedEndpoint?.name === ep.name ? 'bg-gray-700' : 'hover:bg-gray-700/50'}`}>
                                                    <span className={`px-1.5 py-0.5 text-[10px] font-bold rounded border ${methodColors[ep.method]}`}>
                                                        {ep.method}
                                                    </span>
                                                    <span className="text-gray-300 truncate">{ep.name}</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        {/* API Key */}
                        <div className="p-4 border-t border-gray-700">
                            <label className="block text-xs text-gray-400 mb-1">API Key</label>
                            <input type="text" value={apiKey} onChange={e => setApiKey(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm code-font" />
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col">
                        {selectedEndpoint ? (
                            <>
                                {/* Header */}
                                <div className="p-4 border-b border-gray-700 flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <span className={`px-2 py-1 text-xs font-bold rounded border ${methodColors[selectedEndpoint.method]}`}>
                                            {selectedEndpoint.method}
                                        </span>
                                        <code className="code-font text-gray-300">{selectedEndpoint.path}</code>
                                    </div>
                                    <button onClick={executeRequest} disabled={loading}
                                        className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#00FF88] to-[#00D4AA] text-black rounded-lg font-medium disabled:opacity-50">
                                        {loading ? (
                                            <div className="w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin" />
                                        ) : Icons.play}
                                        {loading ? 'Sending...' : 'Send Request'}
                                    </button>
                                </div>

                                <div className="flex-1 flex">
                                    {/* Request Panel */}
                                    <div className="w-1/2 border-r border-gray-700 flex flex-col">
                                        <div className="flex border-b border-gray-700">
                                            {['params', 'body', 'headers', 'curl'].map(tab => (
                                                <button key={tab} onClick={() => setActiveTab(tab)}
                                                    className={`px-4 py-3 text-sm font-medium capitalize ${activeTab === tab ? 'tab-active' : 'text-gray-400 hover:text-white'}`}>
                                                    {tab}
                                                </button>
                                            ))}
                                        </div>

                                        <div className="flex-1 p-4 overflow-auto">
                                            {activeTab === 'params' && (
                                                <div className="space-y-3">
                                                    <p className="text-sm text-gray-400">{selectedEndpoint.desc}</p>
                                                    {selectedEndpoint.path.includes(':id') && (
                                                        <div>
                                                            <label className="block text-xs text-gray-400 mb-1">Path Parameters</label>
                                                            <div className="flex items-center gap-2 bg-gray-800 p-3 rounded-lg">
                                                                <span className="text-gray-400 code-font text-sm">id</span>
                                                                <input type="text" defaultValue="shp_abc123"
                                                                    className="flex-1 bg-transparent border-0 text-sm code-font outline-none" />
                                                            </div>
                                                        </div>
                                                    )}
                                                    {selectedEndpoint.method === 'GET' && (
                                                        <div>
                                                            <label className="block text-xs text-gray-400 mb-1">Query Parameters</label>
                                                            <div className="space-y-2">
                                                                {[
                                                                    { name: 'page', value: '1' },
                                                                    { name: 'per_page', value: '20' },
                                                                    { name: 'status', value: '' }
                                                                ].map((p, i) => (
                                                                    <div key={i} className="flex items-center gap-2 bg-gray-800 p-2 rounded-lg">
                                                                        <input type="checkbox" defaultChecked={!!p.value} className="rounded" />
                                                                        <span className="text-gray-400 code-font text-sm w-24">{p.name}</span>
                                                                        <input type="text" defaultValue={p.value}
                                                                            className="flex-1 bg-gray-700 px-2 py-1 rounded text-sm code-font" />
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {activeTab === 'body' && (
                                                <div>
                                                    <label className="block text-xs text-gray-400 mb-2">Request Body (JSON)</label>
                                                    <textarea value={requestBody} onChange={e => setRequestBody(e.target.value)}
                                                        className="w-full h-80 bg-gray-800 border border-gray-700 rounded-lg p-3 code-font text-sm resize-none"
                                                        spellCheck={false} />
                                                </div>
                                            )}

                                            {activeTab === 'headers' && (
                                                <div className="space-y-2">
                                                    {[
                                                        { name: 'Authorization', value: `Bearer ${apiKey}`, locked: true },
                                                        { name: 'Content-Type', value: 'application/json', locked: true },
                                                        { name: 'X-Idempotency-Key', value: '' }
                                                    ].map((h, i) => (
                                                        <div key={i} className="flex items-center gap-2 bg-gray-800 p-2 rounded-lg">
                                                            <input type="checkbox" defaultChecked={!!h.value} disabled={h.locked} className="rounded" />
                                                            <span className="text-gray-400 code-font text-sm w-36">{h.name}</span>
                                                            <input type="text" defaultValue={h.value} disabled={h.locked}
                                                                className="flex-1 bg-gray-700 px-2 py-1 rounded text-sm code-font disabled:opacity-50" />
                                                        </div>
                                                    ))}
                                                </div>
                                            )}

                                            {activeTab === 'curl' && (
                                                <div>
                                                    <div className="flex items-center justify-between mb-2">
                                                        <label className="text-xs text-gray-400">cURL Command</label>
                                                        <button onClick={() => copyToClipboard(generateCurl())}
                                                            className="flex items-center gap-1 text-xs text-gray-400 hover:text-white">
                                                            {copied ? Icons.check : Icons.copy}
                                                            {copied ? 'Copied!' : 'Copy'}
                                                        </button>
                                                    </div>
                                                    <pre className="bg-gray-800 border border-gray-700 rounded-lg p-3 code-font text-sm text-green-400 whitespace-pre-wrap">
                                                        {generateCurl()}
                                                    </pre>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Response Panel */}
                                    <div className="w-1/2 flex flex-col">
                                        <div className="flex items-center justify-between border-b border-gray-700 px-4">
                                            <div className="flex">
                                                {['body', 'headers'].map(tab => (
                                                    <button key={tab} onClick={() => setResponseTab(tab)}
                                                        className={`px-4 py-3 text-sm font-medium capitalize ${responseTab === tab ? 'tab-active' : 'text-gray-400 hover:text-white'}`}>
                                                        {tab}
                                                    </button>
                                                ))}
                                            </div>
                                            {response && (
                                                <div className="flex items-center gap-3 text-sm">
                                                    <span className={`px-2 py-0.5 rounded font-medium ${response.status < 300 ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                                        {response.status} {response.statusText}
                                                    </span>
                                                    <span className="text-gray-400">{response.time}ms</span>
                                                </div>
                                            )}
                                        </div>

                                        <div className="flex-1 p-4 overflow-auto">
                                            {loading ? (
                                                <div className="flex items-center justify-center h-full">
                                                    <div className="w-8 h-8 border-2 border-gray-700 border-t-[#00FF88] rounded-full animate-spin" />
                                                </div>
                                            ) : response ? (
                                                responseTab === 'body' ? (
                                                    <div>
                                                        <div className="flex justify-end mb-2">
                                                            <button onClick={() => copyToClipboard(response.body)}
                                                                className="flex items-center gap-1 text-xs text-gray-400 hover:text-white">
                                                                {Icons.copy} Copy
                                                            </button>
                                                        </div>
                                                        <pre className="bg-gray-800 border border-gray-700 rounded-lg p-4 code-font text-sm overflow-auto"
                                                            dangerouslySetInnerHTML={{ __html: formatJSON(response.body) }} />
                                                    </div>
                                                ) : (
                                                    <div className="space-y-2">
                                                        {Object.entries(response.headers).map(([k, v], i) => (
                                                            <div key={i} className="flex bg-gray-800 p-2 rounded-lg">
                                                                <span className="text-gray-400 code-font text-sm w-48">{k}</span>
                                                                <span className="code-font text-sm">{v}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )
                                            ) : (
                                                <div className="flex flex-col items-center justify-center h-full text-gray-500">
                                                    <div className="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                                                        {Icons.play}
                                                    </div>
                                                    <p>Click "Send Request" to see the response</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-gray-500">
                                <div className="w-24 h-24 bg-gray-800 rounded-2xl flex items-center justify-center mb-6">
                                    <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                    </svg>
                                </div>
                                <h2 className="text-xl font-semibold text-white mb-2">Routz API Playground</h2>
                                <p className="text-gray-400 mb-6">Select an endpoint from the sidebar to get started</p>
                                <div className="flex gap-4 text-sm">
                                    <a href="/api-docs.html" className="text-[#00FF88] hover:underline">View Documentation →</a>
                                    <span className="text-gray-600">|</span>
                                    <a href="/settings.html#api" className="text-[#00FF88] hover:underline">Manage API Keys →</a>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<APIPlayground />);
    </script>
</body>
</html>
